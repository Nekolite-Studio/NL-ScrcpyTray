# NL-ScrcpyTray ビルドガイド

このドキュメントは、`NL-ScrcpyTray` アプリケーションの新しいアーキテクチャ (WPF + WebView2 + React) に基づくビルド手順を説明します。

## 1. はじめに

本アプリケーションは、以下の2つの主要コンポーネントから構成されています。

-   **バックエンド:** C# (WPF) で記述され、デバイス管理や `scrcpy` の制御など、アプリケーションのコアロジックを担当します。
-   **フロントエンド:** React (TypeScript/JavaScript) で記述され、WebView2を介して表示されるユーザーインターフェースを担当します。

ビルドプロセスは、これら2つのコンポーネントをそれぞれビルドし、最終的に1つの実行可能ファイルに統合する手順を踏みます。

## 2. 前提条件

ビルドを開始する前に、お使いの開発環境に以下のツールがインストールされていることを確認してください。

-   **Node.js:** v18.x 以上 (npm または yarn を含む)
-   **.NET 9 SDK:** (またはプロジェクトで指定されているバージョン)
-   **Visual Studio 2022 (推奨):** 「.NET デスクトップ開発」ワークロードと、最新のWebView2ランタイムを含む。

## 3. 開発ディレクトリ構成

開発は、以下のディレクトリ構成を前提としています。

```
/NL-ScrcpyTray/
├── frontend/          # Reactフロントエンドのソースコード
│   ├── public/
│   ├── src/
│   └── package.json
│
├── src/               # C#バックエンドのソースコード
│   ├── Services/
│   ├── Models/
│   ├── App.xaml
│   └── src.csproj
│
└── NL-ScrcpyTray.sln  # Visual Studio ソリューションファイル
```

**重要:** フロントエンドのソースコードは、リポジトリのルート直下にある `frontend` ディレクトリに配置する必要があります。

## 4. ビルド手順

### ステップ1: フロントエンドのビルド

まず、Reactで記述されたUI部分をビルドし、静的なHTML, JS, CSSファイル群を生成します。

1.  ターミナルを開き、フロントエンドのディレクトリに移動します。
    ```shell
    cd frontend
    ```

2.  依存関係をインストールします。
    ```shell
    npm install
    ```

3.  本番用のビルドを実行します。
    ```shell
    npm run build
    ```

これにより、`frontend/build` (または `frontend/dist`) ディレクトリ内に、最適化された静的ファイルが生成されます。

### ステップ2: バックエンドのビルド

次に、C#で記述されたバックエンド部分をビルドします。このプロセスは、ステップ1で生成されたフロントエンドの成果物を自動的に取り込みます。

1.  リポジトリのルートにある `NL-ScrcpyTray.sln` を Visual Studio で開きます。

2.  ソリューションのビルド構成を `Release` に設定します。

3.  メニューバーから `[ビルド] > [ソリューションのビルド]` を選択し、ビルドを実行します。

ビルドが成功すると、`src/bin/Release/net9.0-windows/` のような出力ディレクトリに、`NL-ScrcpyTray.exe` が生成されます。

## 5. 開発時のビルドと実行 (VSCode)

本プロジェクトでは、VSCode上での開発体験を向上させるためのタスクが `.vscode/tasks.json` に定義されています。

### .NETバックエンドのビルド自動化

バックエンドのビルドプロセス (`src.csproj`) は、フロントエンドのビルド成果物を自動的に取り込むように構成されています。

- ビルド開始時に、`frontend/dist` ディレクトリが存在するかをチェックします。（`vite build` のデフォルト出力先）
- 存在する場合、その中のすべてのファイルを、最終的な実行ファイルの出力先にある `frontend` フォルダ (`.../net9.0-windows/frontend/`) へコピーします。

これにより、開発者はフロントエンドをビルドした後、バックエンドをビルドするだけで、常に最新のUIが組み込まれたアプリケーションを生成できます。

### 推奨: デバッグ実行 (F5)

最も簡単で推奨される開発方法は、VSCodeで `F5` キーを押すことです。
これにより、以下のタスクが自動的に実行され、デバッグセッションが開始されます。

1. **フロントエンド開発サーバーの起動**: `npm run dev` が実行され、HMR (ホットモジュールリプレイスメント) が有効になります。
2. **バックエンドのビルド**: .NETプロジェクトがビルドされます。
3. **デバッガーの接続**: ビルドされた.NETアプリケーションが起動し、デバッガーがアタッチされます。

### ビルドして実行 (デバッグなし)

デバッガーを接続せずに、単純にビルドしてアプリケーションを実行したい場合は、以下の手順で `launch-dotnet-app` タスクを実行します。

1. `Ctrl+Shift+P` でコマンドパレットを開きます。
2. `Tasks: Run Task` を検索して選択します。
3. 一覧から `launch-dotnet-app` を選択して実行します。

このタスクは、バックエンドをビルドした後、`dotnet run --no-build` でアプリケーションを起動します。